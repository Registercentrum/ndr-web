<div class="row">
    <div class="col-md-12">
        <h1 class="Page-title">Söklista</h1>
        <p>Välj besöksperiod och andra sökkriterier.</p>

        <div class="MultiFilter">
            <div class="MultiFilter-row MultiFilter-row--header">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">
                        Antal matchande patienter:
                    </div>
                    <div class="MultiFilter-row-filterKnobs col-sm-9">
                        <div class="col-sm-7 u-noLeftPadding Progressbar">
                            <progressbar value="( model.filteredSubjectsLength * 100 ) / model.allSubjectsLength" max="100"></progressbar>
                        </div>
                        <div class="col-sm-2 u-noLeftPadding">{{ model.filteredSubjectsLength + " av " + model.allSubjectsLength }}</div>
                    </div>
                </div>
            </div>

            <div class="MultiFilter-row">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">Besöksperiod</div>
                    <div class="MultiFilter-row-filterKnobs col-sm-6">
                        <div class="FilterDatePopup">
                            <div class="input-group FilterDatePopup-group">
                                <span class="input-group-addon">
                                    <button
                                            type="button"
                                            class="FilterDatePopup-button"
                                            ng-click="open($event, 'from')">
                                        <i class="fa fa-calendar"></i>
                                    </button>
                                </span>
                                <input
                                        type="text"
                                        class="FilterDatePopup-input form-control"
                                        datepicker-popup="{{ format }}"
                                        ng-model="datePickers.from.date"
                                        is-open="datePickers.from.opened"
                                        min-date="minDate"
                                        max-date="'2015-06-22'"
                                        datepicker-options="dateOptions"
                                        date-disabled="disabled(date, mode)"
                                        ng-required="true"
                                        close-text="Close">

                                 <span class="input-group-addon">
                                   <button
                                           type="button"
                                           class="FilterDatePopup-button"
                                           ng-click="open($event, 'to')">
                                       <i class="fa fa-calendar"></i>
                                   </button>
                                 </span>
                                <input
                                        type="text"
                                        class="FilterDatePopup-input form-control"
                                        datepicker-popup="{{ format }}"
                                        ng-model="datePickers.to.date"
                                        is-open="datePickers.to.opened"
                                        min-date="minDate"
                                        max-date="'2015-06-22'"
                                        datepicker-options="dateOptions"
                                        date-disabled="disabled(date, mode)"
                                        ng-required="true"
                                        close-text="Close">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="MultiFilter-row">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">Diabetestyp</div>
                    <div class="MultiFilter-row-filterKnobs col-sm-6">
                        <select
                                ng-options="type.id as type.text for type in activeFilters.diabetesTypes"
                                class="form-control"
                                ng-model="selectedFilters.diabetesTypes"
                                name=""
                                id="">
                        </select>
                    </div>
                </div>
            </div>

            <div class="MultiFilter-row">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">HbA1c</div>
                    <div class="MultiFilter-row-filterKnobs col-sm-6">
                        <div
                                slider
                                ng-model="selectedFilters.hbMin"
                                ng-model-range="selectedFilters.hbMax"
                                floor="0"
                                ceiling="200"
                                class="RangeSlider">
                        </div>
                    </div>
                    <div class="col-sm-3 form-inline">
                        <input class="form-control" type="number" placeholder="min" ng-model="selectedFilters.hbMin">
                        <input class="form-control" type="number" placeholder="max" ng-model="selectedFilters.hbMax">
                    </div>
                </div>
            </div>

            <!-- Additional filtering -->
            <div class="MultiFilter-row" ng-repeat="(key, filter) in chosenAdditionalFilters">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">{{ filter.question }}</div>
                    <div class="MultiFilter-row-filterKnobs col-sm-6">

                        <!-- If there are min and max values, display as range slider -->
                        <div
                            slider
                            ng-if="filter.minValue !== null && filter.maxValue !== null"
                            ng-model="selectedFilters.additional[key].min"
                            ng-model-range="selectedFilters.additional[key].max"
                            ng-disabled="selectedFilters.additional[key].undef"
                            floor="{{filter.minValue}}"
                            ceiling="{{filter.maxValue}}"
                            class="RangeSlider">
                        </div>

                        <!-- If domain is enumerable and there are just two options, display them as radio buttons -->
                        <div class="form-inline" ng-if="filter.domain.isEnumerated && filter.domain.domainValues.length === 2">
                            <span class="radio" ng-repeat="option in filter.domain.domainValues">
                                <label>
                                    <input
                                        type="radio"
                                        ng-model="selectedFilters.additional[key].value"
                                        ng-disabled="selectedFilters.additional[key].undef"
                                        value="{{ option.code }}">
                                    {{ option.text }}
                                </label>
                            </span>
                        </div>

                        <!-- If domain is enumerable and have more than two options, display them as a select -->
                        <select
                            ng-if="filter.domain.isEnumerated && filter.domain.domainValues.length > 2"
                            ng-options="option.code as option.text for option in filter.domain.domainValues"
                            ng-model="selectedFilters.additional[key].value"
                            ng-disabled="selectedFilters.additional[key].undef"
                            class="form-control pull-left">
                            <option value="">Välj {{ filter.question }}</option>
                        </select>

                    </div>
                    <div class="col-sm-3 form-inline">
                        <span class="checkbox"><label><input type="checkbox" ng-model="selectedFilters.additional[key].undef"> saknar värde</label></span>
                        <i class="fa fa-minus-circle fa-1x text-danger" ng-click="removeChosenFIlter(key)"></i>
                    </div>
                </div>
            </div>

            <div class="MultiFilter-row">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">Valbar</div>
                    <div class="MultiFilter-row-filterKnobs col-sm-6">
                        <select ng-options="filter.contactAttributeID as filter.question for filter in additionalFilters" ng-model="chosenAdditionalFilter" name="" id="" class="form-control">
                            <option value="">Välj filter</option>
                        </select>
                    </div>
                </div>
            </div>

            <!--             <div class="MultiFilter-row">
                            <div class="row">
                                <div class="MultiFilter-row-label col-sm-3">Debug</div>
                                <div class="MultiFilter-row-filterKnobs col-sm-9">{{ selectedFilters }}</div>
                            </div>
                        </div>
             -->        </div>

        <div class="table-responsive">
            <table id="Table--patients" datatable="ng" dt-options="dtOptions" dt-column-defs="dtColumnDefs" width="100%" class="table responsive table-striped table-bordered row-border hover">
                <thead>
                <tr>
                    <td>Mer</td>
                    <td>Personnummer</td>
                    <td>Senaste besök</td>
                    <td>Blodtryck</td>
                    <td>HbA1c</td>
                    <td>Funktioner</td>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="subject in model.filteredSubjects">
                    <td class="details-control"><i class="fa fa-plus-circle fa-1x"></i></td>
                    <td once-text="subject.aggregatedProfile.subject.socialNumber"></td>
                    <td once-text="subject.aggregatedProfile.contactDate | date:'yyyy-MM-dd'"</td>
                    <td once-text="subject.aggregatedProfile.bpDiastolic"</td>
                    <td once-text="subject.aggregatedProfile.hba1c"</td>
                    <td><a once-href="'#/inloggad/patient/' + subject.subjectID" class="Button Button--info Button--small">Visa profil</a></td>
                </tr>
                </tbody>
            </table>
        </div>

         <pre>
            <!-- {{  model  | json  }} -->
            <!-- {{  activeFilters  | json  }} -->
            <!-- {{  model.filteredSubjects  | json  }} -->
        </pre>
    </div>
</div>


