<div class="row">
    <div class="col-md-5">
        <h1 class="Page-title">Söklista</h1>
        <p>Välj besöksperiod och andra sökkriterier.</p>
    </div>
    <form class="col-md-7 text-right pull-right" role="search" name="subjectForm" novalidate>
      <div class="PatientSearch">
        <div class="PatientSearch-inner">
              <span class="PatientSearch-icon">
                <img src="/images/svgmin/icon_search.svg" class="PatientSearch-icon-img">
              </span>
          <input class="PatientSearch-input" ng-model="socialnumber" type="search" placeholder="Skriv in personnummer" required
                 ng-pattern="accountHelpers.pnrRegex">
          <button class="PatientSearch-searchButton" ng-click="getSubject(true)" ng-disabled="!subjectForm.$valid">Sök</button><button class="PatientSearch-reportButton">Rapportera</button>
        </div>
      </div>
    </form>
  <div class="col-md-12">
        <div class="MultiFilter">
            <div class="MultiFilter-row MultiFilter-row--header">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">
                        Antal matchande patienter:
                    </div>
                    <div class="MultiFilter-row-filterKnobs col-sm-9">
                        <div class="col-sm-7 u-noLeftPadding Progressbar">
                            <progressbar value="( model.filteredSubjectsLength * 100 ) / model.allSubjectsLength" max="100"></progressbar>
                        </div>
                        <div class="col-sm-2 u-noLeftPadding">{{ model.filteredSubjectsLength + " av " + model.allSubjectsLength }}</div>
                    </div>
                </div>
            </div>

            <div class="MultiFilter-row">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">Besöksperiod</div>
                    <div class="MultiFilter-row-filterKnobs col-sm-6">
                        <div class="FilterDatePopup">
                            <div class="input-group FilterDatePopup-group">
                                <span class="input-group-addon">
                                    <button
                                            type="button"
                                            class="FilterDatePopup-button"
                                            ng-click="open($event, 'from')">
                                        <i class="fa fa-calendar"></i>
                                    </button>
                                </span>
                                <input
                                        type="text"
                                        class="FilterDatePopup-input form-control"
                                        datepicker-popup="{{ format }}"
                                        ng-model="datePickers.from.date"
                                        is-open="datePickers.from.opened"
                                        min-date="minDate"
                                        max-date="'2015-06-22'"
                                        datepicker-options="dateOptions"
                                        date-disabled="disabled(date, mode)"
                                        ng-required="true"
                                        close-text="Close">

                                 <span class="input-group-addon">
                                   <button
                                           type="button"
                                           class="FilterDatePopup-button"
                                           ng-click="open($event, 'to')">
                                       <i class="fa fa-calendar"></i>
                                   </button>
                                 </span>
                                <input
                                        type="text"
                                        class="FilterDatePopup-input form-control"
                                        datepicker-popup="{{ format }}"
                                        ng-model="datePickers.to.date"
                                        is-open="datePickers.to.opened"
                                        min-date="minDate"
                                        max-date="'2015-06-22'"
                                        datepicker-options="dateOptions"
                                        date-disabled="disabled(date, mode)"
                                        ng-required="true"
                                        close-text="Close">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional filtering -->
            <div class="MultiFilter-row" ng-repeat="(key, filter) in filters" ng-if="isDisplayed(filter.columnName)">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">{{ filter.question }}</div>
                    <div class="MultiFilter-row-filterKnobs col-sm-6">

                        <!-- If there is max value, display as range slider -->
                        <div
                            slider
                            ng-if="filter.maxValue !== null"
                            ng-model="selectedFilters[filter.columnName].min"
                            ng-model-range="selectedFilters[filter.columnName].max"
                            ng-disabled="selectedFilters[filter.columnName].undef"
                            floor="{{ filter.minValue || 0 }}"
                            ceiling="{{ filter.maxValue }}"
                            class="RangeSlider">
                        </div>

                        <!-- If domain is enumerable and there are just two options, display them as radio buttons -->
                        <div class="form-inline" ng-if="filter.domain.isEnumerated && filter.domain.domainValues.length === 2">
                            <span class="radio" ng-repeat="option in filter.domain.domainValues">
                                <label>
                                    <input
                                        type="radio"
                                        ng-model="selectedFilters[filter.columnName].value"
                                        ng-disabled="selectedFilters[filter.columnName].undef"
                                        value="{{ option.code }}">
                                    {{ option.text }}
                                </label>
                            </span>
                        </div>

                        <!-- If domain is enumerable and have more than two options, display them as a select -->
                        <select
                            ng-if="filter.domain.isEnumerated && filter.domain.domainValues.length > 2"
                            ng-options="option.code as option.text for option in filter.domain.domainValues"
                            ng-model="selectedFilters[filter.columnName].value"
                            ng-disabled="selectedFilters[filter.columnName].undef"
                            class="form-control pull-left">
                            <option value="">Välj {{ filter.question }}</option>
                        </select>

                    </div>
                    <div class="col-sm-3 form-inline">
                        <span class="checkbox"><label><input type="checkbox" ng-model="selectedFilters[filter.columnName].undef"> saknar värde</label></span>
                        <i class="fa fa-minus-circle fa-1x text-danger" ng-click="removeChosenFilter(filter.columnName)" ng-if="!isRequired(filter.columnName)"></i>
                    </div>
                </div>
            </div>

            <div class="MultiFilter-row">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">Valbar</div>
                    <div class="MultiFilter-row-filterKnobs col-sm-6">
                        <select ng-options="filter.columnName as filter.question for filter in filters | filter: {isChosen: false}" ng-model="chosenFilter" name="" id="" class="form-control">
                            <option value="">Välj filter</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- <div class="MultiFilter-row">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">Debug</div>
                    <div class="MultiFilter-row-filterKnobs col-sm-9">{{ selectedFilters }}</div>
                </div>
            </div> -->
        </div>

        <div class="table-responsive">
            <table id="Table--patients" datatable="ng" dt-options="dtOptions" dt-column-defs="dtColumnDefs" width="100%" class="table responsive table-striped table-bordered row-border hover">
                <thead>
                <tr>
                    <td>Mer</td>
                    <td>Personnummer</td>
                    <td>Senaste besök</td>
                    <!-- <td>Blodtryck</td> -->
                    <td>HbA1c</td>
                    <!--<td ng-repeat="f in filters | filter:{isChosen:true}">{{ f.question }}</td>-->

                    <td>Funktioner</td>

                    <!--<td ng-repeat="f in filters | filter:{isChosen:true}">{{ f }}</td>-->

                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="subject in model.filteredSubjects">
                    <td class="details-control"><i class="fa fa-plus-circle fa-1x"></i></td>
                    <td once-text="subject.aggregatedProfile.subject.socialNumber"></td>
                    <td once-text="subject.aggregatedProfile.contactDate | date:'yyyy-MM-dd'"></td>
                    <!-- <td once-text="subject.aggregatedProfile.bpDiastolic"</td> -->
                    <td once-text="subject.aggregatedProfile.hba1c"></td>
                    <!--<td ng-repeat="f in filters | filter:{isChosen:true}">{{ subject.aggregatedProfile[f.columnName] }}</td>-->

                    <td><a once-href="'#/inloggad/patient/' + subject.subjectID" class="Button Button--info Button--small">Visa profil</a></td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- <pre>
            &lt;!&ndash; {{  model  | json  }} &ndash;&gt;
            &lt;!&ndash; {{  activeFilters  | json  }} &ndash;&gt;
            &lt;!&ndash; {{  model.filteredSubjects  | json  }} &ndash;&gt;
        </pre>-->
    </div>
</div>


