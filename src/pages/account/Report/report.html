<div class="row Report">
  <div class="col-md-12">
    <h1 class="Page-title">Rapportera</h1>


    <script type="text/ng-template" id="myModalContent.html">
       <!-- <div class="modal-header">
            &lt;!&ndash;<h3 class="modal-title">I'm a modal!</h3>&ndash;&gt;
      </div> -->
      <div class="modal-body text-center">
        <a class="pull-right" ng-click="cancel()"><i style="color:#333" class="fa fa-close"></i></a>

        <h3>Sparat</h3>
        <p>Du har sparat information för patient {{ subject.socialNumber }}</p>

        <a href="#/inloggad/patient/{{ subject.socialNumber }}" ng-click="cancel()" class="Button Button--default Button--centered Button--info Button--centered--80">Visa profil</a>
        <a class="Button Button--default Button--centered Button--info Button--centered--80" ng-click="cancel()">Rapportera för en annan patient</a>
      </div>
      <!--  <div class="modal-footer">
            <button class="btn btn-primary" ng-click="ok()">OK</button>
            <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
        </div>-->
    </script>


    <div class="Panel">

      <form class="" role="search" name="subjectForm" novalidate>
        <div class="PatientSearch">
          <span class="PatientSearch-icon">
            <img src="/images/svgmin/icon_search.svg" class="PatientSearch-icon-img">
          </span>
          <input class="PatientSearch-input" ng-model="socialnumber" type="search" placeholder="Skriv in personnummer" required
                 ng-pattern="pnrRegex">
          <button class="PatientSearch-searchButton" ng-click="getSubject(true)" ng-disabled="!subjectForm.$valid">Sök</button>
        </div>
      </form>


     <!--   <form class="navbar-form navbar-left" role="search" name="subjectForm" novalidate>
            <div class="input-group">
                <span class="input-group-addon" >Personnummer</span>
                <input type="text" class="form-control" ng-model="socialnumber" placeholder="skriv in personnummer"  required
                       ng-pattern="pnrRegex" />
            </div>
            <button class="btn btn-primary" style="width: 120px;" ng-click="getSubject(true)" ng-disabled="!subjectForm.$valid">Sök</button>
        </form>-->

    </div>
  </div>

</div>

<div class="row" ng-show="subject != null">

  <div class="col-md-12">

    <div class="PatientHeader clearfix">
      <div class="PatientHeader-personNumber col-md-6 u-noLeftPadding">
          {{ subject.socialNumber }}
      </div>

      <div class="col-md-6">
        <form id="contactSelect" class="form-horizontal pull-left" role="form" >
          <select style="width:220px" ng-model="contactToUpdate" class="form-control" ng-change="setContact(contactToUpdate)" ng-options="contact.contactDate.split('T')[0] for contact in subject.contacts">
              <option value="">Visa/komplettera besök</option>
          </select>
        </form>

        <div class="PatientHeader-navigation u-noRightPadding pull-right">
          <a href="#/inloggad/patient/{{ subject.socialNumber }}" type="submit" class="Button Button--info" ng-click="">Gå till profil</a>
        </div>
      </div>
    </div>

    <div class="Panel">

      <div class="col-md-12 alert alert-danger" ng-show="serverSubjectError != null">
        {{serverSubjectError}}
      </div>

        <div ng-show="subject != null" >
          <form name="contactForm" class="Report-form form-horizontal" role="form" novalidate>

            <div ng-show="accountModel.activeAccount != null">
                <div class="row">
                  <h3 class="Panel-title Report-title col-md-4">Rapportera nytt besök</h3>

                  <div class="col-md-6 Report-patientMeta">
                      <!--{{subject.socialNumber}}<br />-->
                      {{subject.sex.text}} |
                      {{subject.diabetesType.text}} |
                      {{subject.yearOfOnset}}
                  </div>
                </div>




                <div class="row Report-formGroup">
                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="contactDate">Besöksdatum</label>
                    <div ng-class="{ 'has-error' : contactForm.contactDate.$invalid && !contactForm.contactDate.$pristine }">
                      <!--<p class="input-group">
                        <input name="contactDate" type="text" class="form-control" placeholder="ÅÅÅÅ-MM-DD"
                          datepicker-popup="{{format}}"
                          ng-model="contactModel.contactDate"
                          ng-class="{ 'has-no-error' : !contactForm.contactDate.$invalid && contactModel.contactDate != null}"
                          is-open="opened"
                          ng-Blur="checkDate;tryCalculateGFR"
                          datepicker-options="dateOptions"
                          date-disabled="disabled(date, mode)"
                          ng-required="true"
                          close-text="Stäng" />
                        <span class="input-group-btn">
                          <button type="button" class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button>
                        </span>
                      </p>

                      <p><i>Ett exempel på datumväljare. Behövs datumväljare?</i></p>-->
                      <input name="contactDate" type="text" class="form-control"
                             ng-model="contactModel.contactDate"
                             ng-Blur="checkDate"
                             ng-model-options="{ updateOn: 'Blur' }"
                             ng-class="{ 'has-no-error' : !contactForm.contactDate.$invalid && contactModel.contactDate != null}"
                             required placeholder="ÅÅÅÅ-MM-DD" />
                      <p class="help-block" ng-show="contactForm.contactDate.$error.checkDate">Det finns redan ett besök på detta datum! Uppdatera detta besök eller välj ett nytt datum.</p>
                    </div>
                  </div>
                </div>


              <div class="row Report-formGroup">
                <div class="col-md-5">
                  <label class="Report-formGroup-label" for="yearOfOnset">Debutår</label>

                  <input name="yearOfOnset" type="number" class="form-control"
                         ng-model="contactModel.yearOfOnset"
                         ng-class="{ 'has-no-error' : contactModel.yearOfOnset != null}"
                         placeholder="Debutår">
                  <p ng-show="contactForm.yearOfOnset.$pristine && contactModel.yearOfOnset != null && contactModel.yearOfOnset == subject.yearOfOnset && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>

                </div>
              </div>


              <div class="row Report-formGroup">
                <div class="col-md-5">
                  <label class="Report-formGroup-label" for="diabetesTypeID" class="">Diabetestyp</label>

                  <select name="diabetesTypeID" class="form-control"
                          ng-model="contactModel.diabetesTypeID"
                          ng-class="{ 'has-no-error' : contactModel.diabetesTypeID != null}"
                          ng-model-options="{ updateOn: 'blur' }"
                          ng-options="type.id as type.text for type in lists.diabetesTypes" >
                    <option value="">-- välj diabetestyp --</option>
                  </select>
                  <p ng-show="contactForm.diabetesTypeID.$pristine && subject.diabetesType != null && contactModel.diabetesTypeID != null && contactModel.diabetesTypeID == subject.diabetesType.id && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                </div>
              </div>


              <div class="row Report-formGroup">
                <div class="col-md-12">
                  <div class="Report-formGroup-form ">
                    <label class="Report-formGroup-label" for="treatmentID" class="">Diabetesbehandling</label>
                    <p ng-show="contactForm.treatmentID.$pristine && contactModel.treatmentID == contactModel.treatmentID && contactToUpdate == null" class="help-block iteration"></p>
                    <select name="treatmentID" class="form-control"
                            ng-model="contactModel.treatmentID"
                            ng-class="{ 'has-no-error' : contactModel.treatmentID != null}"
                            ng-options="type.id as type.text for type in lists.treatments" >
                      <option value="">-- välj behandling --</option>
                    </select>
                    <p ng-show="contactForm.treatmentID.$pristine && contactModel.treatmentID != null && contactModel.treatmentID == lastContact.treatment.id && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div><!-- end Report-formGroup-form -->
                </div>

                  <div class="row" ng-show="(contactModel.treatmentID == 3 || contactModel.treatmentID == 4 || contactModel.treatmentID == 9 || contactModel.treatmentID == 10)"><!-- ng-show="(contactModel.treatmentID == 3 || contactModel.treatmentID == 4 || contactModel.treatmentID == 9 || contactModel.treatmentID == 10)" -->
                    <div class="col-md-12">
                      <div class="Report-formGroup-form">
                        <label class="Report-formGroup-label" for="insulinMethodID" class="">Metod att ge insulin</label>
                        <select name="insulinMethodID" class="form-control"
                                ng-model="contactModel.insulinMethodID"
                                ng-change="insulinMethodChanged()"
                                ng-class="{ 'has-no-error' : contactModel.insulinMethodID != null}"
                                ng-options="type.id as type.text for type in lists.insulinMethods" >
                          <option value="">-- välj metod att ge insulin --</option>
                        </select>
                        <p ng-show="contactForm.insulinMethodID.$pristine && contactModel.insulinMethodID != null && contactModel.insulinMethodID == lastContact.insulinMethod.id && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                      </div><!-- end Report-formGroup-form -->
                    </div>

                    <div ng-show="(contactModel.insulinMethodID == 2 || contactModel.pumpOngoingID > 0 || (lastContact != null && lastContact.insulinMethod != null && lastContact.insulinMethod.id == 2))"> <!-- ng-show="(contactModel.insulinMethodID == 2 || contactModel.pumpOngoingID > 0 || (lastContact != null && lastContact.insulinMethod != null && lastContact.insulinMethod.id == 2))" -->
                      <div class="col-md-12">
                        <div class="Report-formGroup-form">
                          <label class="Report-formGroup-label" for="pumpIndicationID" class="">Pumpindikation</label>
                          <select name="pumpIndicationID" class="form-control"
                                  ng-model="contactModel.pumpIndicationID"
                                  ng-class="{ 'has-no-error' : contactModel.pumpIndicationID != null}"
                                  ng-options="type.id as type.text for type in lists.pumpIndications" >
                            <option value="">-- välj pumpindikation --</option>
                          </select>
                          <p ng-show="contactForm.pumpIndicationID.$pristine && contactModel.pumpIndicationID != null && contactModel.pumpIndicationID == lastContact.pumpIndication.id && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                        </div><!-- end Report-formGroup-form -->
                      </div>
                      <br><br>
                      <div class="col-md-6">
                        <div class="Report-formGroup-form">
                          <label class="Report-formGroup-label" for="pumpOngoingID" class="">Pågående pumpmodell</label>
                          <select name="pumpOngoingID" class="form-control"
                                  ng-model="contactModel.pumpOngoingID"
                                  ng-change="pumpOngoingChanged()"
                                  ng-class="{ 'has-no-error' : contactModel.pumpOngoingID != null}"
                                  ng-options="type.id as type.text for type in lists.pumps" >
                            <option value="">-- välj pumpmodell --</option>
                          </select>
                          <p ng-show="contactForm.pumpOngoingID.$pristine && contactModel.pumpOngoingID != null && contactModel.pumpOngoingID == lastContact.pumpOngoing.id && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="Report-formGroup-form">
                          <label class="Report-formGroup-label" for="pumpOngoingSerial" class="">Serienummer</label>
                          <div ng-class="{ 'has-error' : contactForm.pumpOngoingSerial.$invalid && !contactForm.pumpOngoingSerial.$pristine }">
                            <input name="pumpOngoingSerial" type="text" class="form-control" placeholder="Serienummer"
                                   ng-model="contactModel.pumpOngoingSerial"
                                   ng-class="{ 'has-no-error' : contactModel.pumpOngoingSerial != null}"
                                   ng-model-options="{ updateOn: 'blur' }">
                            <p ng-show="contactForm.pumpOngoingSerial.$pristine && contactModel.pumpOngoingSerial != null && contactModel.pumpOngoingSerial == lastContact.pumpOngoingSerial && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                          </div>
                        </div><!-- end Report-formGroup-form -->
                      </div>
                    </div><!-- end ng-show -->




                    <div class="col-md-12">
                      <div class="Report-formGroup-form">
                        <button type="submit" class="Button Button--default" ng-click="togglePumpProblem()" >Rapportera/dölj pumpproblem</button>
                      </div>
                    </div>



                    <div class="" ng-show="showPumpProblem">
                      <label class="Report-formGroup-label" for="pumpProblem" class="">Problem med pågående pump (Flera val möjliga)</label>
                      <div class="col-md-5">
                        <p>
                          <input name="pumpProblemKeto" type="checkbox" ng-model="contactModel.pumpProblemKeto">
                          Frekventa diabetesketoacidoser
                        </p>
                        <p>
                          <input name="pumpProblemHypo" type="checkbox" ng-model="contactModel.pumpProblemHypo">
                          Frekventa hypoglykemier
                        </p>
                        <p>
                          <input name="pumpProblemSkininfection" type="checkbox" ng-model="contactModel.pumpProblemSkininfection">
                          Lokala hudinfektioner
                        </p>
                        <p>
                          <input name="pumpProblemSkinreaction" type="checkbox" ng-model="contactModel.pumpProblemSkinreaction">
                          Lokala hudreaktioner
                        </p>
                      </div>
                    </div>
                  </div><!-- end row for ng-show for insulinbehandling -->



                <div class="col-md-5">
                  <div class="Report-formGroup-form">
                    <label class="Report-formGroup-label" for="pumpNewID" class="">Ny pumpmodell (Endast vid byte eller nyinsättning)</label>
                    <select name="pumpNewID" class="form-control"
                            ng-model="contactModel.pumpNewID"
                            ng-change="pumpNewChanged()"
                            ng-class="{ 'has-no-error' : contactModel.pumpNewID != null }"
                            ng-options="type.id as type.text for type in lists.pumps" >
                      <option value="">-- välj pumpmodell --</option>
                    </select>
                  </div><!-- Report-formGroup-form -->
                </div>

                <div class="col-md-5">
                  <div class="Report-formGroup-form">
                  <label class="Report-formGroup-label" for="pumpNewSerial" class="">Serienummer</label>
                  <div ng-class="{ 'has-error' : contactForm.pumpNewSerial.$invalid && !contactForm.pumpNewSerial.$pristine }">
                    <input name="pumpNewSerial" type="text" class="form-control" placeholder="Serienummer"
                           ng-model="contactModel.pumpNewSerial"
                           ng-class="{ 'has-no-error' : contactModel.pumpNewSerial != null}"
                           ng-model-options="{ updateOn: 'blur' }">
                  </div>
                  </div><!-- Report-formGroup-form -->
                </div>


                <div class="col-md-12">
                  <div class="Report-formGroup-form">
                    <button type="submit" class="Button Button--default" ng-click="togglePumpClosureReason()" >Rapportera/dölj pumpavslut</button>
                    <div class="" ng-show="showPumpClosureReason">
                      <label class="Report-formGroup-label" for="pumpClosureReasonID" class="">Pumpbehandling avslutad, ange huvudsaklig orsak</label>
                      <select name="pumpClosureReasonID" class="form-control"
                              ng-model="contactModel.pumpClosureReasonID"
                              ng-class="{ 'has-no-error' : contactModel.pumpClosureReasonID != null}"
                              ng-options="type.id as type.text for type in lists.pumpClosureReasons" >
                        <option value="">-- välj alternativ --</option>
                      </select>
                      <p ng-show="contactForm.pumpClosureReasonID.$pristine && contactModel.pumpClosureReasonID != null && contactModel.pumpClosureReasonID == lastContact.pumpClosureReason.id && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                    </div>
                  </div><!-- end Report-formGroup-form -->
                </div>


              </div><!-- end Report-formGroup -->


              <div class="row Report-formGroup">
                <div class="col-md-5">
                    <label class="Report-formGroup-label" for="hba1c">HbA1c, mmol/mol</label>
                    <div class="" ng-class="{ 'has-error' : contactForm.hba1c.$invalid && contactForm.hba1c.$dirty }">
                        <input name="hba1c" type="number" min="21" max="177" class="form-control" placeholder="HbA1c"
                               decimals="0"
                               ng-Debounce="500"
                               ng-model="contactModel.hba1c"
                               ng-class="{ 'has-no-error' : !contactForm.hba1c.$invalid && contactModel.hba1c != null}">
                        <p ng-show="contactForm.hba1c.$error.min || contactForm.hba1c.$error.max" class="help-block">HbA1c kan anta ett värde mellan 21 och 177.</p>
                    </div>
                  </div>
              </div>


              <div class="row Report-formGroup">
                <div class="col-md-5 Report-formGroup-form">
                  <label class="Report-formGroup-label" for="weight" class="">Vikt, kg</label>
                  <div ng-class="{ 'has-error' : contactForm.weight.$invalid && !contactForm.weight.$pristine }">
                    <input name="weight" type="number" min="1" max="350" class="form-control" placeholder="Vikt"
                           ng-model="contactModel.weight"
                           decimals="0"
                           ng-class="{ 'has-no-error' : !contactForm.weight.$invalid && contactModel.weight != null}"
                           ng-change="tryCalculateBMI()"
                           ng-model-options="{ updateOn: 'blur' }">
                    <p ng-show="contactForm.weight.$error.min || contactForm.weight.$error.max" class="help-block">Vikt kan anta ett värde mellan 1 och 350.</p>
                  </div>
                  </div>

                  <div class="col-md-5 Report-formGroup-form">
                  <label class="Report-formGroup-label" for="height" class="">Längd, cm</label>
                  <div ng-class="{ 'has-error' : contactForm.height.$invalid && !contactForm.height.$pristine }">
                    <input name="height" type="number" min="60" max="220" class="form-control" placeholder="Längd"
                           ng-model="contactModel.height"
                           decimals="0"
                           ng-change="tryCalculateBMI()"
                           ng-class="{ 'has-no-error' : !contactForm.height.$invalid && contactModel.height != null}"
                           ng-model-options="{ updateOn: 'blur' }">
                    <p ng-show="contactForm.height.$error.min || contactForm.height.$error.max" class="help-block">Längd kan anta ett värde mellan 60 och 220.</p>
                    <p ng-show="contactForm.height.$pristine && contactModel.height != null && contactModel.height == lastContact.height && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>
                  </div>

                <div class="col-md-5 Report-formGroup-form">
                  <label class="Report-formGroup-label" for="waist" class="">Midjeomfång, cm</label>
                  <div ng-class="{ 'has-error' : contactForm.waist.$invalid && !contactForm.waist.$pristine }">
                    <input name="waist" type="number" min="40" max="250" class="form-control" placeholder="Midjeomfång"
                           ng-model="contactModel.waist"
                           decimals="0"
                           ng-class="{ 'has-no-error' : !contactForm.waist.$invalid && contactModel.waist != null}"
                           ng-model-options="{ updateOn: 'blur' }">
                    <p ng-show="contactForm.waist.$error.min || contactForm.waist.$error.max" class="help-block">Midjeomfång kan anta ett värde mellan 40 och 250.</p>
                  </div>
                  </div>

                <div class="col-md-5 Report-formGroup-form">
                  <label class="Report-formGroup-label" for="bmi" class="">BMI</label>
                  <div ng-class="{ 'has-error' : contactForm.bmi.$invalid && !contactForm.bmi.$pristine }">
                    <input name="bmi" type="number" min="15" max="62" class="form-control" placeholder="BMI"
                           ng-model="contactModel.bmi"
                           decimals="0"
                           ng-class="{ 'has-no-error' : !contactForm.bmi.$invalid && contactModel.bmi != null}"
                           ng-model-options="{ updateOn: 'blur' }">
                    <p ng-show="contactForm.bmi.$error.min || contactForm.bmi.$error.max" class="help-block">BMI kan anta ett värde mellan 15 och 62.</p>
                  </div>
                  <!--<div class="col-md-3">
                      <button ng-click="calculateBMI()" class="btn btn-default btn-block" >Beräkna BMI</button>
                  </div>-->
                  </div>
                </div><!-- end formGroup -->
              </div><!-- end row -->


              <div class="row Report-formGroup">
                <div class="col-md-5">
                  <div class="Report-formGroup-form">
                    <label class="Report-formGroup-label" for="bpSystolic" class="">Systoliskt blodtryck, mm Hg</label>
                    <div ng-class="{ 'has-error' : contactForm.bpSystolic.$invalid && !contactForm.bpSystolic.$pristine }">
                      <input name="bpSystolic" type="number" min="50" max="250" class="form-control" placeholder="Systoliskt blodtryck"
                             ng-model="contactModel.bpSystolic"
                             decimals="0"
                             ng-class="{ 'has-no-error' : !contactForm.bpSystolic.$invalid && contactModel.bpSystolic != null}"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.bpSystolic.$error.min || contactForm.bpSystolic.$error.max" class="help-block">Systoliskt blodtryck kan anta ett värde mellan 50 och 250.</p>
                    </div>
                  </div><!-- end  Report-formGroup-form -->
                  </div>
                <div class="col-md-5">
                  <div class="Report-formGroup-form">
                    <label class="Report-formGroup-label" for="bpDiastolic" class="">Diastoliskt blodtryck, mm Hg</label>
                    <div ng-class="{ 'has-error' : contactForm.bpDiastolic.$invalid && !contactForm.bpDiastolic.$pristine }">
                      <input name="bpDiastolic" type="number" min="40" max="250" class="form-control" placeholder="Diastoliskt blodtryck"
                             ng-model="contactModel.bpDiastolic"
                             decimals="0"
                             ng-class="{ 'has-no-error' : !contactForm.bpDiastolic.$invalid && contactModel.bpDiastolic != null}"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.bpDiastolic.$error.min || contactForm.bpDiastolic.$error.max" class="help-block">Diastoliskt blodtryck kan anta ett värde mellan 40 och 250.</p>
                    </div>
                </div><!-- end  Report-formGroup-form -->
                </div><!-- end col-md-5 -->
              </div><!-- end Report-formGroup -->



              <div class="row Report-formGroup">
                <div class="col-md-5">
                  <label class="Report-formGroup-label" for="antihypertensivesCode" class="">Antihypertensiva läkemedel</label>
                  <select  name="antihypertensivesCode" class="form-control"
                           ng-model="contactModel.antihypertensivesCode"
                           ng-class="{ 'has-no-error' : contactModel.antihypertensivesCode != null}"
                           ng-options="type.code as type.text for type in lists.yn" >
                    <option value="">-- Ja / Nej --</option>
                  </select>
                  <p ng-show="contactForm.antihypertensivesCode.$pristine && contactModel.antihypertensivesCode != null && contactModel.antihypertensivesCode == lastContact.antihypertensives.code && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                </div>
              </div>


              <div class="row Report-formGroup">
                <div class="col-md-5">
                  <label class="Report-formGroup-label" for="lipidLoweringDrugsCode" class="">Lipidsänkande läkemedel</label>
                  <select name="lipidLoweringDrugsCode" class="form-control"
                          ng-model="contactModel.lipidLoweringDrugsCode"
                          ng-class="{ 'has-no-error' : contactModel.lipidLoweringDrugsCode != null}"
                          ng-options="type.code as type.text for type in lists.yn" >
                    <option value="">-- Ja / Nej --</option>
                  </select>
                  <p ng-show="contactForm.lipidLoweringDrugsCode.$pristine && contactModel.lipidLoweringDrugsCode != null && contactModel.lipidLoweringDrugsCode == lastContact.lipidLoweringDrugs.code && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                </div>

              </div>




              <div class="row Report-formGroup">
                <div class="col-md-10">
                  <label class="Report-formGroup-label" for="physicalActivity" class="">Fysisk aktivitet (30 min promenad eller motsvarande)</label>
                      <select name="physicalActivityID"
                              ng-model="contactModel.physicalActivityID"
                              ng-class="{ 'has-no-error' : contactModel.physicalActivityID != null}"
                              ng-options="type.id as type.text for type in lists.physicalActivity" >
                          <option value="">-- välj alternativ --</option>
                      </select>
                </div>
              </div>




              <div class="row Report-formGroup">
                <div class="col-md-5">
                  <label class="Report-formGroup-label" for="smokingHabitID" class="">Rökvanor</label>
                    <select name="smokingHabitID" class="form-control"
                            ng-model="contactModel.smokingHabitID"
                            ng-class="{ 'has-no-error' : contactModel.smokingHabitID != null}"
                            ng-options="type.id as type.text for type in lists.smokingHabits" >
                        <option value="">-- välj rökvanor --</option>
                    </select>
                    <p ng-show="contactForm.smokingHabitID.$pristine && contactModel.smokingHabitID != null && contactModel.smokingHabitID == lastContact.smokingHabit.id && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>

                  <label class="Report-formGroup-label" for="smokingEndYear" class="">Slutat År</label>
                  <input type="number" min="1980" max="2015" class="form-control"
                         ng-model="contactModel.smokingEndYear"
                         ng-disabled="contactModel.smokingHabitID != 4"
                         ng-class="{ 'has-no-error' : !contactForm.smokingEndYear.$invalid && contactModel.smokingEndYear != null && contactModel.smokingHabitID == 4}"
                         decimals="0"
                         placeholder="År">
                </div>
              </div>










              <div class="row Report-formGroup">
                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="aspirinCode" class="">ASA (obs ej Waran)</label>
                      <select name="aspirinCode" class="form-control"
                              ng-model="contactModel.aspirinCode"
                              ng-class="{ 'has-no-error' : contactModel.aspirinCode != null}"
                              ng-options="type.code as type.text for type in lists.yn" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.aspirinCode.$pristine && contactModel.aspirinCode != null && contactModel.aspirinCode == lastContact.aspirin.code && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="waranCode" class="">Waran</label>
                      <select name="waranCode" class="form-control"
                              ng-model="contactModel.waranCode"
                              ng-class="{ 'has-no-error' : contactModel.waranCode != null}"
                              ng-options="type.code as type.text for type in lists.yn" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.waranCode.$pristine && contactModel.waranCode != null && contactModel.waranCode == lastContact.waran.code && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

              </div>




              <div class="row Report-formGroup">


                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="macroscopicProteinuriaCode" class="">Makroalbuminuri </label>
                      <select name="macroscopicProteinuriaCode" class="form-control" ng-change="macroChanged()"
                              ng-model="contactModel.macroscopicProteinuriaCode"
                              ng-class="{ 'has-no-error' : contactModel.macroscopicProteinuriaCode != null}"
                              ng-options="type.code as type.text for type in lists.yn" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.macroscopicProteinuriaCode.$pristine && contactModel.macroscopicProteinuriaCode != null && contactModel.macroscopicProteinuriaCode == lastContact.macroscopicProteinuria.code && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="microscopicProteinuriaCode" class="">Mikroalbuminuri </label>
                      <select name="microscopicProteinuriaCode" ng-disabled="contactModel.macroscopicProteinuriaCode == 1" class="form-control"
                              ng-model="contactModel.microscopicProteinuriaCode"
                              ng-class="{ 'has-no-error' : contactModel.microscopicProteinuriaCode != null && contactModel.macroscopicProteinuriaCode != 1}"
                              ng-options="type.code as type.text for type in lists.ynMicroscopicProteinuria" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.microscopicProteinuriaCode.$pristine && contactModel.microscopicProteinuriaCode != null && contactModel.microscopicProteinuriaCode == lastContact.microscopicProteinuria.code && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

              </div>




              <div class="row Report-formGroup">


                  <div class="col-md-5" ng-class="{ 'has-error' : contactForm.serumCreatinine.$invalid && !contactForm.serumCreatinine.$pristine }">
                    <label class="Report-formGroup-label" for="serumCreatinine" class="">Kreatinin</label>
                      <input name="serumCreatinine" type="number" min="10" max="1500" class="form-control" placeholder="Kreatinin"
                             ng-model="contactModel.serumCreatinine"
                             decimals="0"
                             ng-class="{ 'has-no-error' : !contactForm.serumCreatinine.$invalid && contactModel.serumCreatinine != null}"
                             ng-change="tryCalculateGFR()"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.serumCreatinine.$error.min || contactForm.serumCreatinine.$error.max" class="help-block">Kreatinin kan anta ett värde mellan 10 och 1500.</p>
                  </div>

                  <div class="col-md-5" ng-class="{ 'has-error' : contactForm.gfr.$invalid && !contactForm.gfr.$pristine }">
                    <label class="Report-formGroup-label" for="gfr" class="">GFR</label>
                      <input name="gfr" disabled type="number" class="form-control" placeholder="GFR" ng-model="contactModel.gfr" ng-model-options="{ updateOn: 'blur' }">
                  </div>

              </div>



              <div class="row Report-formGroup">


                  <div class="col-md-5" ng-class="{ 'has-error' : contactForm.cholesterol.$invalid && !contactForm.cholesterol.$pristine }">
                    <label class="Report-formGroup-label" for="height" class="">Kolesterol</label>
                      <input name="cholesterol" type="number" min="1" max="20" class="form-control" placeholder="Kolesterol"
                             ng-model="contactModel.cholesterol"
                             decimals="1"
                             ng-class="{ 'has-no-error' : !contactForm.cholesterol.$invalid && contactModel.cholesterol != null}"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.cholesterol.$error.min || contactForm.cholesterol.$error.max" class="help-block">Kolesterol kan anta ett värde mellan 1 och 20.</p>
                  </div>

                  <div class="col-md-5" ng-class="{ 'has-error' : contactForm.triglyceride.$invalid && !contactForm.triglyceride.$pristine }">
                    <label class="Report-formGroup-label" for="triglyceride" class="">Triglycerider</label>
                      <input name="triglyceride" type="number" min="0.1" max="40" class="form-control" placeholder=" Triglycerider"
                             ng-model="contactModel.triglyceride"
                             decimals="1"
                             ng-class="{ 'has-no-error' : !contactForm.triglyceride.$invalid && contactModel.triglyceride != null}"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.triglyceride.$error.min || contactForm.triglyceride.$error.max" class="help-block">Triglycerider kan anta ett värde mellan 0,1 och 40.</p>
                  </div>

              </div>



              <div class="row Report-formGroup">


                  <div class="col-md-5" ng-class="{ 'has-error' : contactForm.hdl.$invalid && !contactForm.hdl.$pristine }">
                    <label class="Report-formGroup-label" for="hdl" class="">HDL</label>
                      <input name="hdl" type="number" min="0.1" max="5" class="form-control" placeholder="HDL"
                             ng-model="contactModel.hdl"
                             decimals="1"
                             ng-class="{ 'has-no-error' : !contactForm.hdl.$invalid && contactModel.hdl != null}"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.hdl.$error.min || contactForm.hdl.$error.max" class="help-block">HDL kan anta ett värde mellan 0,1 och 5.</p>
                  </div>

                  <div class="col-md-5" ng-class="{ 'has-error' : contactForm.ldl.$invalid && !contactForm.ldl.$pristine }">
                    <label class="Report-formGroup-label" for="ldl" class="">LDL</label>
                      <input name="ldl" type="number" min="0.5" max="10" class="form-control" placeholder="LDL"
                             ng-model="contactModel.ldl"
                             decimals="1"
                             ng-class="{ 'has-no-error' : !contactForm.ldl.$invalid && contactModel.ldl != null}"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.ldl.$error.min || contactForm.ldl.$error.max" class="help-block">LDL kan anta ett värde mellan 0,5 och 10.</p>
                  </div>
                  <div class="col-md-10">
                    <div class="Report-submitWrapper">
                      <button ng-click="calculateLDL()"
                              ng-disabled="contactModel.cholesterol==null || contactModel.hdl==null || contactModel.triglyceride==null"
                              tooltip="Beräknas enligt Friedewalds formel"
                              class="Button Button--default" >Beräkna LDL</button>
                      </div>
                  </div>

              </div>


              <div class="row Report-formGroup">


                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="ischemicHeartDiseaseCode" class="">Ischemisk hjärtsjukdom någonsin</label>
                      <select name="ischemicHeartDiseaseCode" class="form-control"
                              ng-model="contactModel.ischemicHeartDiseaseCode"
                              ng-class="{ 'has-no-error' : contactModel.ischemicHeartDiseaseCode != null}"
                              ng-options="type.code as type.text for type in lists.yn" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.ischemicHeartDiseaseCode.$pristine && contactModel.ischemicHeartDiseaseCode != null && contactModel.ischemicHeartDiseaseCode == lastContact.ischemicHeartDisease.code && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="cerebrovascularDiseaseCode" class="">Cerebrovaskulär sjukdom någonsin</label>
                      <select name="cerebrovascularDiseaseCode" class="form-control"
                              ng-model="contactModel.cerebrovascularDiseaseCode"
                              ng-class="{ 'has-no-error' : contactModel.cerebrovascularDiseaseCode != null}"
                              ng-options="type.code as type.text for type in lists.yn" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.cerebrovascularDiseaseCode.$pristine && contactModel.cerebrovascularDiseaseCode != null && contactModel.cerebrovascularDiseaseCode == lastContact.cerebrovascularDisease.code && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

              </div>







              <div class="row Report-formGroup">


                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="fundusExaminationDate" class="">Datum för senaste ögonbottenundersökning</label>
                      <input name="fundusExaminationDate" type="text" class="form-control"
                             ng-model="contactModel.fundusExaminationDate"
                             ng-class="{ 'has-no-error' : !contactForm.fundusExaminationDate.$invalid && contactModel.fundusExaminationDate != null}"
                             placeholder="Undersökningsdatum">
                      <p ng-show="contactForm.fundusExaminationDate.$pristine && contactModel.fundusExaminationDate != null && contactModel.fundusExaminationDate == lastContact.fundusExaminationDate.split('T')[0] && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

                </div>



              <div class="row Report-formGroup">


                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="diabeticRetinopathyCode" class="">Diabetesretinopati</label>
                      <select name="diabeticRetinopathyCode" class="form-control"
                              ng-model="contactModel.diabeticRetinopathyCode"
                              ng-class="{ 'has-no-error' : contactModel.diabeticRetinopathyCode != null}"
                              ng-options="type.code as type.text for type in lists.yn" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.diabeticRetinopathyCode.$pristine && contactModel.diabeticRetinopathyCode != null && contactModel.diabeticRetinopathyCode == lastContact.diabeticRetinopathy.code && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="diagnosisWorseSeeingEyeID" class="">Diagnos på sämsta ögat</label>
                      <select name="diagnosisWorseSeeingEyeID" class="form-control"
                              ng-model="contactModel.diagnosisWorseSeeingEyeID"
                              ng-class="{ 'has-no-error' : contactModel.diagnosisWorseSeeingEyeID != null}"
                              ng-options="type.id as type.text for type in lists.diagnosisWorseSeeingEye" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.diagnosisWorseSeeingEyeID.$pristine && contactModel.diagnosisWorseSeeingEyeID != null && contactModel.diagnosisWorseSeeingEyeID == lastContact.diagnosisWorseSeeingEye.id && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>
              </div>




              <div class="row Report-formGroup">


                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="visualLossCode" class="">Synnedsättning pga diabetes</label>
                      <select name="visualLossCode" class="form-control"
                              ng-model="contactModel.visualLossCode"
                              ng-class="{ 'has-no-error' : contactModel.visualLossCode != null}"
                              ng-options="type.code as type.text for type in lists.yn" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.visualLossCode.$pristine && contactModel.visualLossCode != null && contactModel.visualLossCode == lastContact.visualLoss.code && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="laserTreatmentCode" class="">Laserbehandlad</label>
                      <select name="laserTreatmentCode" class="form-control"
                              ng-model="contactModel.laserTreatmentCode"
                              ng-class="{ 'has-no-error' : contactModel.laserTreatmentCode != null}"
                              ng-options="type.code as type.text for type in lists.yn" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.laserTreatmentCode.$pristine && contactModel.laserTreatmentCode != null && contactModel.laserTreatmentCode == lastContact.laserTreatment.code && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

              </div>



              <div class="row Report-formGroup">


                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="fundusExaminationDate" class="">Datum för senaste fotundersökning</label>
                      <input name="footExaminationDate" type="text" class="form-control"
                             ng-model="contactModel.footExaminationDate"
                             ng-class="{ 'has-no-error' : !contactForm.footExaminationDate.$invalid && contactModel.footExaminationDate != null}"
                             placeholder="Undersökningsdatum">
                      <p ng-show="contactForm.footExaminationDate.$pristine && contactModel.footExaminationDate != null && contactModel.footExaminationDate == lastContact.footExaminationDate.split('T')[0] && contactToUpdate == null" class="help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>


                  <div class="col-md-5">
                    <label class="Report-formGroup-label" for="footRiscCategoryID" class="">Riskkategori fot</label>
                      <select name="footRiscCategoryID" class="form-control"
                              ng-model="contactModel.footRiscCategoryID"
                              ng-class="{ 'has-no-error' : contactModel.footRiscCategoryID != null}"
                              ng-options="type.id as type.text for type in lists.footRiscCategory" >
                          <option value="">-- välj kategori --</option>
                      </select>
                  </div>

              </div>




              <div class="row Report-formGroup">


                  <div class="col-md-8">
                    <label class="Report-formGroup-label" for="hypoglycemiaSevereID" class="">Hypoglykemiförekomst svåra (Hjälp av utomstående. Antal senaste året) </label>
                      <select name="hypoglycemiaSevereID" class="form-control"
                              ng-model="contactModel.hypoglycemiaSevereID"
                              ng-class="{ 'has-no-error' : contactModel.hypoglycemiaSevereID != null}"
                              ng-options="type.id as type.text for type in lists.hypoglycemiaSevere" >
                          <option value="">-- välj alternativ --</option>
                      </select>
                  </div>

              </div>




              <div class="row" ng-show="serverSaveErrors.length>0">
                <div class="col-md-offset-2 col-md-10 alert alert-danger">
                  <ul>
                    <li ng-repeat="s in serverSaveErrors" >
                        {{s}}
                    </li>
                  </ul>
                </div>
              </div>






              <div class="row">
                  <div class="col-md-3 pull-right Report-submitWrapper">
                      <button type="submit" ng-click="saveContact()" class="Button Button--default" ng-disabled="!contactForm.$valid" >Spara</button>
                  </div>
              </div>
            </div><!-- end ng-show -->
            <div id="serverMessage" class="error"></div>
          </form>
        </div>
    </div> <!-- end Panel -->




    </div>
  </div>


       <!--<pre>-->

      <!--{{ serverError }}-->
      <!--{{  accountModel | json  }}-->
      <!--</pre>-->


  </div>

</div>


