<div class="row Report">
  <div class="col-md-5">
    <h1 class="Page-title">Rapportera</h1>
  </div>

    <form class="col-md-7 text-right" role="search" name="subjectForm" novalidate>
        <div class="PatientSearch">
            <div class="PatientSearch-inner">
            <span class="PatientSearch-icon">
              <img src="/images/svgmin/icon_search.svg" class="PatientSearch-icon-img">
            </span>
                <input class="PatientSearch-input" ng-model="socialnumber" type="search" placeholder="Skriv in personnummer" required ng-pattern="accountHelpers.pnrRegex">
                <button class="PatientSearch-searchButton" ng-click="getSubject(true)" ng-disabled="!subjectForm.$valid">Rapportera</button>
            </div>
        </div>
    </form>

</div>

<div class="row" ng-show="subject != null">

  <div class="col-md-12">

    <div class="PatientHeader clearfix">
      <div class="PatientHeader-personNumber col-md-6 u-noLeftPadding">
          {{ subject.socialNumber }}
      </div>

      <div class="col-md-6">
        <form id="contactSelect" class="PatientHeader-showVisit form-horizontal pull-left" role="form" >
          <select style="width:220px" ng-model="contactToUpdate" class="form-control" ng-change="setContact(contactToUpdate)" ng-options="contact.contactDate.split('T')[0] for contact in subject.contacts">
              <option value="">Visa/komplettera besök</option>
          </select>
        </form>

        <div class="PatientHeader-navigation u-noRightPadding pull-right">
          <a href="#/inloggad/patient/{{ subject.subjectID }}" type="submit" class="Button Button--info" ng-click="">Gå till profil</a>
        </div>
      </div>
    </div>

    <div class="Panel">

      <div class="col-md-12 alert alert-danger" ng-show="serverSubjectError != null">
        {{serverSubjectError}}
      </div>

        <div ng-show="subject != null" >
          <form name="contactForm" class="Report-form form-horizontal" role="form" novalidate>

            <div ng-show="accountModel.activeAccount != null">
                <div class="row">
                  <h3 class="Panel-title Report-title col-md-4">Rapportera nytt besök</h3>

                  <div class="col-md-6 Report-patientMeta">
                      <!--{{subject.socialNumber}}<br />-->
                      <!--{{subject.sex.text}} |
                      {{subject.diabetesType.text}} |
                      {{subject.yearOfOnset}}-->
                  </div>
                </div>




                <div class="row Report-formGroup">
                  <div class="col-md-5">
                    <label class="" for="contactDate">Besöksdatum</label>
                    <div ng-class="{ 'has-error' : contactForm.contactDate.$invalid && !contactForm.contactDate.$pristine }">
                      <!--<p class="input-group">
                        <input name="contactDate" type="text" class="form-control" placeholder="ÅÅÅÅ-MM-DD"
                          datepicker-popup="{{format}}"
                          ng-model="contactModel.contactDate"
                          ng-class="{ 'has-no-error' : !contactForm.contactDate.$invalid && contactModel.contactDate != null}"
                          is-open="opened"
                          ng-Blur="checkDate;tryCalculateGFR"
                          datepicker-options="dateOptions"
                          date-disabled="disabled(date, mode)"
                          ng-required="true"
                          close-text="Stäng" />
                        <span class="input-group-btn">
                          <button type="button" class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button>
                        </span>
                      </p>

                      <p><i>Ett exempel på datumväljare. Behövs datumväljare?</i></p>-->
                      <input name="contactDate" type="text" class="form-control"
                             ng-model="contactModel.contactDate"
                             ng-Blur="checkDate"
                             ng-model-options="{ updateOn: 'Blur' }"
                             ng-class="{ 'has-no-error' : !contactForm.contactDate.$invalid && contactModel.contactDate != null}"
                             required placeholder="ÅÅÅÅ-MM-DD" />
                      <p class="Report-formItemHelp help-block" ng-show="contactForm.contactDate.$error.checkDate">Det finns redan ett besök på detta datum! Uppdatera detta besök eller välj ett nytt datum.</p>
                    </div>
                  </div>
                </div>


              <div class="row Report-formGroup">
                <div class="col-md-5">
                  <label class="" for="yearOfOnset">Debutår</label>

                  <input name="yearOfOnset" type="number" class="form-control"
                         ng-model="contactModel.yearOfOnset"
                         ng-class="{ 'has-no-error' : contactModel.yearOfOnset != null}"
                         placeholder="Debutår">
                  <p ng-show="contactForm.yearOfOnset.$pristine && contactModel.yearOfOnset != null && contactModel.yearOfOnset == subject.yearOfOnset && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>

                </div>
              </div>


              <div class="row Report-formGroup">
                <div class="col-md-5">
                  <label class="" for="diabetesType" class="">Diabetestyp</label>

                  <select name="diabetesType" class="form-control"
                          ng-model="contactModel.diabetesType"
                          ng-class="{ 'has-no-error' : contactModel.diabetesType != null}"
                          ng-model-options="{ updateOn: 'blur' }"
                          ng-options="type.code as type.text for type in lists.diabetesType.domain.domainValues" >
                    <option value="">-- välj diabetestyp --</option>
                  </select>
                  <p ng-show="contactForm.diabetesType.$pristine && subject.diabetesType != null && contactModel.diabetesType != null && contactModel.diabetesType == subject.diabetesType && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                </div>
              </div>

              <div class="row Report-formGroup">
                <div class="col-md-12">
                  <div class="Report-formGroup-form ">
                    <label class="" for="treatment" class="">Diabetesbehandling</label>
                    <p ng-show="contactForm.treatment.$pristine && contactModel.treatment == contactModel.treatment && contactToUpdate == null" class="Report-formItemHelp help-block iteration"></p>
                    <select name="treatment" class="form-control"
                            ng-model="contactModel.treatment"
                            ng-class="{ 'has-no-error' : contactModel.treatment != null}"
                            ng-options="type.code as type.text for type in lists.treatment.domain.domainValues" >
                      <option value="">-- välj behandling --</option>
                    </select>
                    <p ng-show="contactForm.treatment.$pristine && contactModel.treatment != null && contactModel.treatment == lastContact.treatment && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div><!-- end Report-formGroup-form -->
                </div>

                  <div class="row" ng-show="(contactModel.treatment == 3 || contactModel.treatment == 4 || contactModel.treatment == 9 || contactModel.treatment == 10)">
                    <div class="col-md-12">
                      <div class="Report-formGroup-form">
                        <label class="" for="insulinMethod" class="">Metod att ge insulin</label>
                        <select name="insulinMethod" class="form-control"
                                ng-model="contactModel.insulinMethod"
                                ng-change="insulinMethodChanged()"
                                ng-class="{ 'has-no-error' : contactModel.insulinMethod != null}"
                                ng-options="type.code as type.text for type in lists.insulinMethod.domain.domainValues" >
                          <option value="">-- välj metod att ge insulin --</option>
                        </select>
                        <p ng-show="contactForm.insulinMethod.$pristine && contactModel.insulinMethod != null && contactModel.insulinMethod == lastContact.insulinMethod && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                      </div><!-- end Report-formGroup-form -->
                    </div>

                    <div ng-show="(contactModel.insulinMethod == 2 || contactModel.pumpOngoing > 0 || (lastContact != null && lastContact.insulinMethod != null && lastContact.insulinMethod == 2))">
                      <div class="col-md-12">
                        <div class="Report-formGroup-form">
                          <label class="" for="pumpIndication" class="">Pumpindikation</label>
                          <select name="pumpIndication" class="form-control"
                                  ng-model="contactModel.pumpIndication"
                                  ng-class="{ 'has-no-error' : contactModel.pumpIndication != null}"
                                  ng-options="type.code as type.text for type in lists.pumpIndication.domain.domainValues" >
                            <option value="">-- välj pumpindikation --</option>
                          </select>
                          <p ng-show="contactForm.pumpIndication.$pristine && contactModel.pumpIndication != null && contactModel.pumpIndication == lastContact.pumpIndication && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                        </div><!-- end Report-formGroup-form -->
                      </div>
                      <br><br>
                      <div class="col-md-6">
                        <div class="Report-formGroup-form">
                          <label class="" for="pumpOngoing" class="">Pågående pumpmodell</label>
                          <select name="pumpOngoing" class="form-control"
                                  ng-model="contactModel.pumpOngoing"
                                  ng-change="pumpOngoingChanged()"
                                  ng-class="{ 'has-no-error' : contactModel.pumpOngoing != null}"
                                  ng-options="type.code as type.text for type in lists.pumpOngoing.domain.domainValues" >
                            <option value="">-- välj pumpmodell --</option>
                          </select>
                          <p ng-show="contactForm.pumpOngoing.$pristine && contactModel.pumpOngoing != null && contactModel.pumpOngoing == lastContact.pumpOngoing && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="Report-formGroup-form">
                          <label class="" for="pumpOngoingSerial" class="">Serienummer</label>
                          <div ng-class="{ 'has-error' : contactForm.pumpOngoingSerial.$invalid && !contactForm.pumpOngoingSerial.$pristine }">
                            <input name="pumpOngoingSerial" type="text" class="form-control" placeholder="Serienummer"
                                   ng-model="contactModel.pumpOngoingSerial"
                                   ng-class="{ 'has-no-error' : contactModel.pumpOngoingSerial != null}"
                                   ng-model-options="{ updateOn: 'blur' }">
                            <p ng-show="contactForm.pumpOngoingSerial.$pristine && contactModel.pumpOngoingSerial != null && contactModel.pumpOngoingSerial == lastContact.pumpOngoingSerial && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                          </div>
                        </div><!-- end Report-formGroup-form -->
                      </div>
                    </div><!-- end ng-show -->




                    <div class="col-md-12">
                      <div class="Report-formGroup-form">
                        <button type="submit" class="Button Button--default" ng-click="togglePumpProblem()" >Rapportera/dölj pumpproblem</button>
                      </div>
                    </div>



                    <div class="" ng-show="showPumpProblem">
                      <label class="" for="pumpProblem" class="">Problem med pågående pump (Flera val möjliga)</label>
                      <div class="col-md-5">
                        <p>
                          <input name="pumpProblemKeto" type="checkbox" ng-model="contactModel.pumpProblemKeto">
                          Frekventa diabetesketoacidoser
                        </p>
                        <p>
                          <input name="pumpProblemHypo" type="checkbox" ng-model="contactModel.pumpProblemHypo">
                          Frekventa hypoglykemier
                        </p>
                        <p>
                          <input name="pumpProblemSkininfection" type="checkbox" ng-model="contactModel.pumpProblemSkininfection">
                          Lokala hudinfektioner
                        </p>
                        <p>
                          <input name="pumpProblemSkinreaction" type="checkbox" ng-model="contactModel.pumpProblemSkinreaction">
                          Lokala hudreaktioner
                        </p>
                      </div>
                    </div>
                  </div><!-- end row for ng-show for insulinbehandling -->



                <div class="col-md-5">
                  <div class="Report-formGroup-form">
                    <label class="" for="pumpNew" class="">Ny pumpmodell (Endast vid byte eller nyinsättning)</label>
                    <select name="pumpNew" class="form-control"
                            ng-model="contactModel.pumpNew"
                            ng-change="pumpNewChanged()"
                            ng-class="{ 'has-no-error' : contactModel.pumpNew != null }"
                            ng-options="type.code as type.text for type in lists.pumpNew.domain.domainValues" >
                      <option value="">-- välj pumpmodell --</option>
                    </select>
                  </div><!-- Report-formGroup-form -->
                </div>

                <div class="col-md-5">
                  <div class="Report-formGroup-form">
                  <label class="" for="pumpNewSerial" class="">Serienummer</label>
                  <div ng-class="{ 'has-error' : contactForm.pumpNewSerial.$invalid && !contactForm.pumpNewSerial.$pristine }">
                    <input name="pumpNewSerial" type="text" class="form-control" placeholder="Serienummer"
                           ng-model="contactModel.pumpNewSerial"
                           ng-class="{ 'has-no-error' : contactModel.pumpNewSerial != null}"
                           ng-model-options="{ updateOn: 'blur' }">
                  </div>
                  </div><!-- Report-formGroup-form -->
                </div>


                <div class="col-md-12">
                  <div class="Report-formGroup-form">
                    <button type="submit" class="Button Button--default" ng-click="togglePumpClosureReason()" >Rapportera/dölj pumpavslut</button>
                    <div class="" ng-show="showPumpClosureReason">
                      <label class="" for="pumpClosureReason" class="">Pumpbehandling avslutad, ange huvudsaklig orsak</label>
                      <select name="pumpClosureReason" class="form-control"
                              ng-model="contactModel.pumpClosureReason"
                              ng-class="{ 'has-no-error' : contactModel.pumpClosureReason != null}"
                              ng-options="type.code as type.text for type in lists.pumpClosureReason.domain.domainValues" >
                        <option value="">-- välj alternativ --</option>
                      </select>
                      <p ng-show="contactForm.pumpClosureReason.$pristine && contactModel.pumpClosureReason != null && contactModel.pumpClosureReason == lastContact.pumpClosureReason && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                    </div>
                  </div><!-- end Report-formGroup-form -->
                </div>


              </div><!-- end Report-formGroup -->


              <div class="row Report-formGroup">
                <div class="col-md-5">
                    <label class="" for="hba1c">HbA1c, mmol/mol</label>
                    <div class="" ng-class="{ 'has-error' : contactForm.hba1c.$invalid && contactForm.hba1c.$dirty }">
                        <input name="hba1c" type="number" min="21" max="177" class="form-control" placeholder="HbA1c"
                               decimals="0"
                               ng-model="contactModel.hba1c"
                               ng-class="{ 'has-no-error' : !contactForm.hba1c.$invalid && contactModel.hba1c != null}"
							   ng-model-options="{ updateOn: 'blur' }">
                        <p ng-show="contactForm.hba1c.$error.min || contactForm.hba1c.$error.max" class="Report-formItemHelp help-block">HbA1c kan anta ett värde mellan 21 och 177.</p>
                    </div>
                  </div>
              </div>


              <div class="row Report-formGroup">
                <div class="col-md-5 Report-formGroup-form">
                  <label class="" for="weight" class="">Vikt, kg</label>
                  <div ng-class="{ 'has-error' : contactForm.weight.$invalid && !contactForm.weight.$pristine }">
                    <input name="weight" type="number" min="1" max="350" class="form-control" placeholder="Vikt"
                           ng-model="contactModel.weight"
                           decimals="0"
                           ng-class="{ 'has-no-error' : !contactForm.weight.$invalid && contactModel.weight != null}"
                           ng-change="tryCalculateBMI()"
                           ng-model-options="{ updateOn: 'blur' }">
                    <p ng-show="contactForm.weight.$error.min || contactForm.weight.$error.max" class="Report-formItemHelp help-block">Vikt kan anta ett värde mellan 1 och 350.</p>
                  </div>
                  </div>

                  <div class="col-md-5 Report-formGroup-form">
                  <label class="" for="height" class="">Längd, cm</label>
                  <div ng-class="{ 'has-error' : contactForm.height.$invalid && !contactForm.height.$pristine }">
                    <input name="height" type="number" min="60" max="220" class="form-control" placeholder="Längd"
                           ng-model="contactModel.height"
                           decimals="0"
                           ng-change="tryCalculateBMI()"
                           ng-class="{ 'has-no-error' : !contactForm.height.$invalid && contactModel.height != null}"
                           ng-model-options="{ updateOn: 'blur' }">
                    <p ng-show="contactForm.height.$error.min || contactForm.height.$error.max" class="Report-formItemHelp help-block">Längd kan anta ett värde mellan 60 och 220.</p>
                    <p ng-show="contactForm.height.$pristine && contactModel.height != null && contactModel.height == lastContact.height && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>
                  </div>

                <div class="col-md-5 Report-formGroup-form">
                  <label class="" for="waist" class="">Midjeomfång, cm</label>
                  <div ng-class="{ 'has-error' : contactForm.waist.$invalid && !contactForm.waist.$pristine }">
                    <input name="waist" type="number" min="40" max="250" class="form-control" placeholder="Midjeomfång"
                           ng-model="contactModel.waist"
                           decimals="0"
                           ng-class="{ 'has-no-error' : !contactForm.waist.$invalid && contactModel.waist != null}"
                           ng-model-options="{ updateOn: 'blur' }">
                    <p ng-show="contactForm.waist.$error.min || contactForm.waist.$error.max" class="Report-formItemHelp help-block">Midjeomfång kan anta ett värde mellan 40 och 250.</p>
                  </div>
                  </div>

                <div class="col-md-5 Report-formGroup-form">
                  <label class="" for="bmi" class="">BMI</label>
                  <div ng-class="{ 'has-error' : contactForm.bmi.$invalid && !contactForm.bmi.$pristine }">
                    <input name="bmi" type="number" min="15" max="62" class="form-control" placeholder="BMI"
                           ng-model="contactModel.bmi"
                           decimals="0"
                           ng-class="{ 'has-no-error' : !contactForm.bmi.$invalid && contactModel.bmi != null}"
                           ng-model-options="{ updateOn: 'blur' }">
                    <p ng-show="contactForm.bmi.$error.min || contactForm.bmi.$error.max" class="Report-formItemHelp help-block">BMI kan anta ett värde mellan 15 och 62.</p>
                  </div>
                  </div>
                </div><!-- end formGroup -->
              </div><!-- end row -->


              <div class="row Report-formGroup">
                <div class="col-md-5">
                  <div class="Report-formGroup-form">
                    <label class="" for="bpSystolic" class="">Systoliskt blodtryck, mm Hg</label>
                    <div ng-class="{ 'has-error' : contactForm.bpSystolic.$invalid && !contactForm.bpSystolic.$pristine }">
                      <input name="bpSystolic" type="number" min="50" max="250" class="form-control" placeholder="Systoliskt blodtryck"
                             ng-model="contactModel.bpSystolic"
                             decimals="0"
                             ng-class="{ 'has-no-error' : !contactForm.bpSystolic.$invalid && contactModel.bpSystolic != null}"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.bpSystolic.$error.min || contactForm.bpSystolic.$error.max" class="Report-formItemHelp help-block">Systoliskt blodtryck kan anta ett värde mellan 50 och 250.</p>
                    </div>
                  </div><!-- end  Report-formGroup-form -->
                  </div>
                <div class="col-md-5">
                  <div class="Report-formGroup-form">
                    <label class="" for="bpDiastolic" class="">Diastoliskt blodtryck, mm Hg</label>
                    <div ng-class="{ 'has-error' : contactForm.bpDiastolic.$invalid && !contactForm.bpDiastolic.$pristine }">
                      <input name="bpDiastolic" type="number" min="40" max="250" class="form-control" placeholder="Diastoliskt blodtryck"
                             ng-model="contactModel.bpDiastolic"
                             decimals="0"
                             ng-class="{ 'has-no-error' : !contactForm.bpDiastolic.$invalid && contactModel.bpDiastolic != null}"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.bpDiastolic.$error.min || contactForm.bpDiastolic.$error.max" class="Report-formItemHelp help-block">Diastoliskt blodtryck kan anta ett värde mellan 40 och 250.</p>
                    </div>
                </div><!-- end  Report-formGroup-form -->
                </div><!-- end col-md-5 -->
              </div><!-- end Report-formGroup -->



              <div class="row Report-formGroup">
                <div class="col-md-5">
                  <label class="" for="antihypertensives" class="">Antihypertensiva läkemedel</label>
                  <select  name="antihypertensives" class="form-control"
                           ng-model="contactModel.antihypertensives"
                           ng-class="{ 'has-no-error' : contactModel.antihypertensives != null}"
                           ng-options="type.code as type.text for type in lists.antihypertensives.domain.domainValues" >
                    <option value="">-- Ja / Nej --</option>
                  </select>
                  <p ng-show="contactForm.antihypertensives.$pristine && contactModel.antihypertensives != null && contactModel.antihypertensives == lastContact.antihypertensives && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                </div>
              </div>


              <div class="row Report-formGroup">
                <div class="col-md-5">
                  <label class="" for="lipidLoweringDrugs" class="">Lipidsänkande läkemedel</label>
                  <select name="lipidLoweringDrugs" class="form-control"
                          ng-model="contactModel.lipidLoweringDrugs"
                          ng-class="{ 'has-no-error' : contactModel.lipidLoweringDrugs != null}"
                          ng-options="type.code as type.text for type in lists.lipidLoweringDrugs.domain.domainValues" >
                    <option value="">-- Ja / Nej --</option>
                  </select>
                  <p ng-show="contactForm.lipidLoweringDrugs.$pristine && contactModel.lipidLoweringDrugs != null && contactModel.lipidLoweringDrugs == lastContact.lipidLoweringDrugs && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                </div>

              </div>




              <div class="row Report-formGroup">
                <div class="col-md-10">
                  <label class="" for="physicalActivity" class="">Fysisk aktivitet (30 min promenad eller motsvarande)</label>
                      <select name="physicalActivity"
                              ng-model="contactModel.physicalActivity"
                              ng-class="{ 'has-no-error' : contactModel.physicalActivity != null}"
                              ng-options="type.code as type.text for type in lists.physicalActivity.domain.domainValues" >
                          <option value="">-- välj alternativ --</option>
                      </select>
                </div>
              </div>




              <div class="row Report-formGroup">
                <div class="col-md-5">
                  <label class="" for="smokingHabit" class="">Rökvanor</label>
                    <select name="smokingHabit" class="form-control"
                            ng-model="contactModel.smokingHabit"
                            ng-class="{ 'has-no-error' : contactModel.smokingHabit != null}"
                            ng-options="type.code as type.text for type in lists.smokingHabit.domain.domainValues" >
                        <option value="">-- välj rökvanor --</option>
                    </select>
                    <p ng-show="contactForm.smokingHabit.$pristine && contactModel.smokingHabit != null && contactModel.smokingHabit == lastContact.smokingHabit && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>

                  <label class="" for="smokingEndYear" class="">Slutat År</label>
                  <input type="number" min="1980" max="2015" class="form-control"
                         ng-model="contactModel.smokingEndYear"
                         ng-disabled="contactModel.smokingHabit != 4"
                         ng-class="{ 'has-no-error' : !contactForm.smokingEndYear.$invalid && contactModel.smokingEndYear != null && contactModel.smokingHabit == 4}"
                         decimals="0"
                         placeholder="År">
                </div>
              </div>










              <div class="row Report-formGroup">
                  <div class="col-md-5">
                    <label class="" for="aspirin" class="">ASA (obs ej Waran)</label>
                      <select name="aspirin" class="form-control"
                              ng-model="contactModel.aspirin"
                              ng-class="{ 'has-no-error' : contactModel.aspirin != null}"
                              ng-options="type.code as type.text for type in lists.aspirin.domain.domainValues" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.aspirin.$pristine && contactModel.aspirin != null && contactModel.aspirin == lastContact.aspirin && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

                  <div class="col-md-5">
                    <label class="" for="waran" class="">Waran</label>
                      <select name="waran" class="form-control"
                              ng-model="contactModel.waran"
                              ng-class="{ 'has-no-error' : contactModel.waran != null}"
                              ng-options="type.code as type.text for type in lists.waran.domain.domainValues" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.waran.$pristine && contactModel.waran != null && contactModel.waran == lastContact.waran && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

              </div>




              <div class="row Report-formGroup">


                  <div class="col-md-5">
                    <label class="" for="macroscopicProteinuria" class="">Makroalbuminuri </label>
                      <select name="macroscopicProteinuria" class="form-control" ng-change="macroChanged()"
                              ng-model="contactModel.macroscopicProteinuria"
                              ng-class="{ 'has-no-error' : contactModel.macroscopicProteinuria != null}"
                              ng-options="type.code as type.text for type in lists.macroscopicProteinuria.domain.domainValues" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.macroscopicProteinuria.$pristine && contactModel.macroscopicProteinuria != null && contactModel.macroscopicProteinuria == lastContact.macroscopicProteinuria && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

                  <div class="col-md-5">
                    <label class="" for="microscopicProteinuria" class="">Mikroalbuminuri </label>
                      <select name="microscopicProteinuria" ng-disabled="contactModel.macroscopicProteinuria == 1" class="form-control"
                              ng-model="contactModel.microscopicProteinuria"
                              ng-class="{ 'has-no-error' : contactModel.microscopicProteinuria != null && contactModel.macroscopicProteinuria != 1}"
                              ng-options="type.code as type.text for type in lists.microscopicProteinuria.domain.domainValues" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.microscopicProteinuria.$pristine && contactModel.microscopicProteinuria != null && contactModel.microscopicProteinuria == lastContact.microscopicProteinuria && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

              </div>




              <div class="row Report-formGroup">


                  <div class="col-md-5" ng-class="{ 'has-error' : contactForm.creatinine.$invalid && !contactForm.creatinine.$pristine }">
                    <label class="" for="creatinine" class="">Kreatinin</label>
                      <input name="creatinine" type="number" min="10" max="1500" class="form-control" placeholder="Kreatinin"
                             ng-model="contactModel.creatinine"
                             decimals="0"
                             ng-class="{ 'has-no-error' : !contactForm.creatinine.$invalid && contactModel.creatinine != null}"
                             ng-change="tryCalculateGFR()"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.creatinine.$error.min || contactForm.creatinine.$error.max" class="Report-formItemHelp help-block">Kreatinin kan anta ett värde mellan 10 och 1500.</p>
                  </div>

                  <div class="col-md-5" ng-class="{ 'has-error' : contactForm.gfr.$invalid && !contactForm.gfr.$pristine }">
                    <label class="" for="gfr" class="">GFR</label>
                      <input name="gfr" disabled type="number" class="form-control" placeholder="GFR" ng-model="contactModel.gfr" ng-model-options="{ updateOn: 'blur' }">
                  </div>

              </div>



              <div class="row Report-formGroup">


                  <div class="col-md-5" ng-class="{ 'has-error' : contactForm.cholesterol.$invalid && !contactForm.cholesterol.$pristine }">
                    <label class="" for="height" class="">Kolesterol</label>
                      <input name="cholesterol" type="number" min="1" max="20" class="form-control" placeholder="Kolesterol"
                             ng-model="contactModel.cholesterol"
                             decimals="1"
                             ng-class="{ 'has-no-error' : !contactForm.cholesterol.$invalid && contactModel.cholesterol != null}"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.cholesterol.$error.min || contactForm.cholesterol.$error.max" class="Report-formItemHelp help-block">Kolesterol kan anta ett värde mellan 1 och 20.</p>
                  </div>

                  <div class="col-md-5" ng-class="{ 'has-error' : contactForm.triglyceride.$invalid && !contactForm.triglyceride.$pristine }">
                    <label class="" for="triglyceride" class="">Triglycerider</label>
                      <input name="triglyceride" type="number" min="0.1" max="40" class="form-control" placeholder=" Triglycerider"
                             ng-model="contactModel.triglyceride"
                             decimals="1"
                             ng-class="{ 'has-no-error' : !contactForm.triglyceride.$invalid && contactModel.triglyceride != null}"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.triglyceride.$error.min || contactForm.triglyceride.$error.max" class="Report-formItemHelp help-block">Triglycerider kan anta ett värde mellan 0,1 och 40.</p>
                  </div>

              </div>



              <div class="row Report-formGroup">


                  <div class="col-md-5" ng-class="{ 'has-error' : contactForm.hdl.$invalid && !contactForm.hdl.$pristine }">
                    <label class="" for="hdl" class="">HDL</label>
                      <input name="hdl" type="number" min="0.1" max="5" class="form-control" placeholder="HDL"
                             ng-model="contactModel.hdl"
                             decimals="1"
                             ng-class="{ 'has-no-error' : !contactForm.hdl.$invalid && contactModel.hdl != null}"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.hdl.$error.min || contactForm.hdl.$error.max" class="Report-formItemHelp help-block">HDL kan anta ett värde mellan 0,1 och 5.</p>
                  </div>

                  <div class="col-md-5" ng-class="{ 'has-error' : contactForm.ldl.$invalid && !contactForm.ldl.$pristine }">
                    <label class="" for="ldl" class="">LDL</label>
                      <input name="ldl" type="number" min="0.5" max="10" class="form-control" placeholder="LDL"
                             ng-model="contactModel.ldl"
                             decimals="1"
                             ng-class="{ 'has-no-error' : !contactForm.ldl.$invalid && contactModel.ldl != null}"
                             ng-model-options="{ updateOn: 'blur' }">
                      <p ng-show="contactForm.ldl.$error.min || contactForm.ldl.$error.max" class="Report-formItemHelp help-block">LDL kan anta ett värde mellan 0,5 och 10.</p>
                  </div>
                  <div class="col-md-10">
                    <div class="Report-submitWrapper">
                      <button ng-click="calculateLDL()"
                              ng-disabled="contactModel.cholesterol==null || contactModel.hdl==null || contactModel.triglyceride==null"
                              tooltip="Beräknas enligt Friedewalds formel"
                              class="Button Button--default" >Beräkna LDL</button>
                      </div>
                  </div>

              </div>


              <div class="row Report-formGroup">


                  <div class="col-md-5">
                    <label class="" for="ischemicHeartDisease" class="">Ischemisk hjärtsjukdom någonsin</label>
                      <select name="ischemicHeartDisease" class="form-control"
                              ng-model="contactModel.ischemicHeartDisease"
                              ng-class="{ 'has-no-error' : contactModel.ischemicHeartDisease != null}"
                              ng-options="type.code as type.text for type in lists.ischemicHeartDisease.domain.domainValues" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.ischemicHeartDisease.$pristine && contactModel.ischemicHeartDisease != null && contactModel.ischemicHeartDisease == lastContact.ischemicHeartDisease && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

                  <div class="col-md-5">
                    <label class="" for="cerebrovascularDisease" class="">Cerebrovaskulär sjukdom någonsin</label>
                      <select name="cerebrovascularDisease" class="form-control"
                              ng-model="contactModel.cerebrovascularDisease"
                              ng-class="{ 'has-no-error' : contactModel.cerebrovascularDisease != null}"
                              ng-options="type.code as type.text for type in lists.cerebrovascularDisease.domain.domainValues" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.cerebrovascularDisease.$pristine && contactModel.cerebrovascularDisease != null && contactModel.cerebrovascularDisease == lastContact.cerebrovascularDisease && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

              </div>







              <div class="row Report-formGroup">


                  <div class="col-md-5">
                    <label class="" for="fundusExaminationDate" class="">Datum för senaste ögonbottenundersökning</label>
                      <input name="fundusExaminationDate" type="text" class="form-control"
                             ng-model="contactModel.fundusExaminationDate"
                             ng-class="{ 'has-no-error' : !contactForm.fundusExaminationDate.$invalid && contactModel.fundusExaminationDate != null}"
                             placeholder="Undersökningsdatum">
                      <p ng-show="contactForm.fundusExaminationDate.$pristine && contactModel.fundusExaminationDate != null && contactModel.fundusExaminationDate == lastContact.fundusExaminationDate.split('T')[0] && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

                </div>



              <div class="row Report-formGroup">


                  <div class="col-md-5">
                    <label class="" for="diabeticRetinopathy" class="">Diabetesretinopati</label>
                      <select name="diabeticRetinopathy" class="form-control"
                              ng-model="contactModel.diabeticRetinopathy"
                              ng-class="{ 'has-no-error' : contactModel.diabeticRetinopathy != null}"
                              ng-options="type.code as type.text for type in lists.diabeticRetinopathy.domain.domainValues" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.diabeticRetinopathy.$pristine && contactModel.diabeticRetinopathy != null && contactModel.diabeticRetinopathy == lastContact.diabeticRetinopathy && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

                  <div class="col-md-5">
                    <label class="" for="diagnosisWorseSeeingEye" class="">Diagnos på sämsta ögat</label>
                      <select name="diagnosisWorseSeeingEye" class="form-control"
                              ng-model="contactModel.diagnosisWorseSeeingEye"
                              ng-class="{ 'has-no-error' : contactModel.diagnosisWorseSeeingEye != null}"
                              ng-options="type.code as type.text for type in lists.diagnosisWorseSeeingEye.domain.domainValues" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.diagnosisWorseSeeingEye.$pristine && contactModel.diagnosisWorseSeeingEye != null && contactModel.diagnosisWorseSeeingEye == lastContact.diagnosisWorseSeeingEye && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>
              </div>




              <div class="row Report-formGroup">


                  <div class="col-md-5">
                    <label class="" for="visualLoss" class="">Synnedsättning pga diabetes</label>
                      <select name="visualLoss" class="form-control"
                              ng-model="contactModel.visualLoss"
                              ng-class="{ 'has-no-error' : contactModel.visualLoss != null}"
                              ng-options="type.code as type.text for type in lists.visualLoss.domain.domainValues" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.visualLoss.$pristine && contactModel.visualLoss != null && contactModel.visualLoss == lastContact.visualLoss && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

                  <div class="col-md-5">
                    <label class="" for="laserTreatment" class="">Laserbehandlad</label>
                      <select name="laserTreatment" class="form-control"
                              ng-model="contactModel.laserTreatment"
                              ng-class="{ 'has-no-error' : contactModel.laserTreatment != null}"
                              ng-options="type.code as type.text for type in lists.laserTreatment.domain.domainValues" >
                          <option value="">-- Ja / Nej --</option>
                      </select>
                      <p ng-show="contactForm.laserTreatment.$pristine && contactModel.laserTreatment != null && contactModel.laserTreatment == lastContact.laserTreatment && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>

              </div>



              <div class="row Report-formGroup">


                  <div class="col-md-5">
                    <label class="" for="fundusExaminationDate" class="">Datum för senaste fotundersökning</label>
                      <input name="footExaminationDate" type="text" class="form-control"
                             ng-model="contactModel.footExaminationDate"
                             ng-class="{ 'has-no-error' : !contactForm.footExaminationDate.$invalid && contactModel.footExaminationDate != null}"
                             placeholder="Undersökningsdatum">
                      <p ng-show="contactForm.footExaminationDate.$pristine && contactModel.footExaminationDate != null && contactModel.footExaminationDate == lastContact.footExaminationDate.split('T')[0] && contactToUpdate == null" class="Report-formItemHelp help-block iteration">OBS Förifyllt från tidigare rapportering</p>
                  </div>


                  <div class="col-md-5">
                    <label class="" for="footRiscCategory" class="">Riskkategori fot</label>
                      <select name="footRiscCategory" class="form-control"
                              ng-model="contactModel.footRiscCategory"
                              ng-class="{ 'has-no-error' : contactModel.footRiscCategory != null}"
                              ng-options="type.code as type.text for type in lists.footRiscCategory.domain.domainValues" >
                          <option value="">-- välj kategori --</option>
                      </select>
                  </div>

              </div>




              <div class="row Report-formGroup">


                  <div class="col-md-8">
                    <label class="" for="hypoglycemiaSevere" class="">Hypoglykemiförekomst svåra (Hjälp av utomstående. Antal senaste året) </label>
                      <select name="hypoglycemiaSevere" class="form-control"
                              ng-model="contactModel.hypoglycemiaSevere"
                              ng-class="{ 'has-no-error' : contactModel.hypoglycemiaSevere != null}"
                              ng-options="type.code as type.text for type in lists.hypoglycemiaSevere.domain.domainValues" >
                          <option value="">-- välj alternativ --</option>
                      </select>
                  </div>

              </div>




              <div class="row" ng-show="serverSaveErrors.length>0">
                <div class="col-md-offset-2 col-md-10 alert alert-danger">
                  <ul>
                    <li ng-repeat="s in serverSaveErrors" >
                        {{s}}
                    </li>
                  </ul>
                </div>
              </div>






              <div class="row">
                  <div class="col-md-3 pull-right Report-submitWrapper">
                      <button type="submit" ng-click="saveContact()" class="Button Button--default" ng-disabled="!contactForm.$valid" >Spara</button>
                  </div>
              </div>
            </div><!-- end ng-show -->
            <div id="serverMessage" class="error"></div>
          </form>
        </div>
    </div> <!-- end Panel -->




    </div>
  </div>


       <!--<pre>-->

      <!--{{ serverError }}-->
      <!--{{  accountModel | json  }}-->
      <!--</pre>-->


  </div>

</div>

<script type="text/ng-template" id="myModalContent.html">
  <!-- <div class="modal-header">
       &lt;!&ndash;<h3 class="modal-title">I'm a modal!</h3>&ndash;&gt;
 </div> -->
  <div class="modal-body text-center">
    <a class="pull-right" ng-click="cancel()"><i style="color:#333" class="fa fa-close"></i></a>

    <h3>Sparat</h3>
    <p>Du har sparat information för patient {{ subject.socialNumber }}</p>

    <a href="#/inloggad/patient/{{ subject.subjectID }}" ng-click="cancel()" class="Button Button--default Button--centered Button--info Button--centered--80">Visa profil</a>
    <a class="Button Button--default Button--centered Button--info Button--centered--80" ng-click="cancel()">Rapportera för en annan patient</a>
  </div>
  <!--  <div class="modal-footer">
        <button class="btn btn-primary" ng-click="ok()">OK</button>
        <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
    </div>-->
</script>
