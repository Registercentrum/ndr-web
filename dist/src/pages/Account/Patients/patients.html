<div class="row IE-message" style="display: none">
    <div class="col-md-12">
        <div class="Panel" ng-class="hideMessage ? 'ng-hide' : 'ng-show'">
            <i style="float:right; cursor: pointer" ng-click="hideMessage = true" class="fa fa-close"></i>
            <h4>Obs: Du använder en gammal webbläsare, Internet Explorer 8. </h4>
            <p>
                Om denna popup dyker upp, klicka på <strong>"Nej"</strong> så fortsätter sidan att fungera.
            </p>
            <img style="margin:30px" src="./images/terminate_script.gif" alt=""/>
        </div>
    </div>
</div>


<div class="row">
    <div class="col-md-12">
        <h1 class="Page-title">Söklista</h1>
        <p>Välj besöksperiod och andra sökkriterier.</p>
    </div>

    <div class="col-md-12">
        <div class="MultiFilter">
            <div class="MultiFilter-row MultiFilter-row--header">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">
                        Antal matchande patienter:
                    </div>
                    <div class="MultiFilter-row-filterKnobs col-sm-9">
                        <div class="col-sm-7 u-noLeftPadding Progressbar">
                            <progressbar value="( model.filteredSubjectsLength * 100 ) / model.allSubjectsLength" max="100"></progressbar>
                        </div>
                        <div class="col-sm-2 u-noLeftPadding">{{ model.filteredSubjectsLength + " av " + model.allSubjectsLength }}</div>
                    </div>
                </div>
            </div>

            <div class="MultiFilter-row">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">Besöksperiod</div>
                    <div class="MultiFilter-row-filterKnobs col-sm-6">
                        <div class="FilterDatePopup">
                            <div class="input-group FilterDatePopup-group">
                                <span class="input-group-addon">
                                    <button
                                            type="button"
                                            class="FilterDatePopup-button"
                                            ng-click="open($event, 'from')">
                                        <i class="fa fa-calendar"></i>
                                    </button>
                                </span>
                                <input
                                        type="text"
                                        class="FilterDatePopup-input form-control"
                                        datepicker-popup="{{ format }}"
                                        ng-model="datePickers.from.date"
                                        is-open="datePickers.from.opened"
                                        min-date="minDate"
                                        max-date="'2015-06-22'"
                                        datepicker-options="dateOptions"
                                        date-disabled="disabled(date, mode)"
                                        ng-required="true"
                                        close-text="Close">

                                 <span class="input-group-addon">
                                   <button
                                           type="button"
                                           class="FilterDatePopup-button"
                                           ng-click="open($event, 'to')">
                                       <i class="fa fa-calendar"></i>
                                   </button>
                                 </span>
                                <input
                                        type="text"
                                        class="FilterDatePopup-input form-control"
                                        datepicker-popup="{{ format }}"
                                        ng-model="datePickers.to.date"
                                        is-open="datePickers.to.opened"
                                        min-date="minDate"
                                        max-date="'2015-06-22'"
                                        datepicker-options="dateOptions"
                                        date-disabled="disabled(date, mode)"
                                        ng-required="true"
                                        close-text="Close">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional filtering -->
            <div class="MultiFilter-row" ng-repeat="(key, filter) in filters | orderBy: 'displayOrder'" ng-if="isDisplayed(filter.columnName)">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3"><i class="fa fa-times fa-1x text-danger" ng-click="removeChosenFilter(filter.columnName)" ng-if="!isRequired(filter.columnName)"></i>
                        {{ filter.question }}</div>
                    <div class="MultiFilter-row-filterKnobs col-sm-6">

                        <!-- If there is max value, display as range slider -->
                        <div
                                slider
                                ng-if="filter.maxValue !== null"
                                ng-model="selectedFilters[filter.columnName].min"
                                ng-model-range="selectedFilters[filter.columnName].max"
                                ng-disabled="selectedFilters[filter.columnName].undef"
                                floor="{{ filter.minValue || 0 }}"
                                ceiling="{{ filter.maxValue }}"
                                class="RangeSlider">
                        </div>



                        <!-- If domain is enumerable and there are just two options, display them as radio buttons -->
                        <div class="form-inline" ng-if="filter.domain.isEnumerated && filter.domain.domainValues.length === 2">
                            <span class="radio" ng-repeat="option in filter.domain.domainValues">
                                <label>
                                    <input
                                            type="radio"
                                            ng-model="selectedFilters[filter.columnName].value"
                                            ng-disabled="selectedFilters[filter.columnName].undef"
                                            value="{{ option.code }}">
                                    {{ option.text }}
                                </label>
                            </span>
                        </div>

                        <!-- If domain is enumerable and have more than two options, display them as a select -->
                        <select
                                ng-if="filter.domain.isEnumerated && filter.domain.domainValues.length > 2"
                                ng-options="option.code as option.text for option in filter.domain.domainValues"
                                ng-model="selectedFilters[filter.columnName].value"
                                ng-disabled="selectedFilters[filter.columnName].undef"
                                class="form-control pull-left">
                            <option value="">Välj {{ filter.question }}</option>
                        </select>

                        <!-- If the domain is of date type -->
                        <div class="FilterDatePopup" ng-if="filter.domain.name == 'Date'">
                            <div class="input-group FilterDatePopup-group">
                                <span class="input-group-addon">
                                    <button
                                            type="button"
                                            class="FilterDatePopup-button"
                                            ng-click="openPicker($event, filter.columnName, 'from')">
                                        <i class="fa fa-calendar"></i>
                                    </button>
                                </span>
                                <input
                                        type="text"
                                        class="FilterDatePopup-input form-control"
                                        datepicker-popup="{{ format }}"
                                        ng-model="selectedFilters[filter.columnName].from.date"
                                        is-open="selectedFilters[filter.columnName].from.opened"
                                        min-date="minDate"
                                        max-date="'2015-06-22'"
                                        datepicker-options="dateOptions"
                                        date-disabled="disabled(date, mode)"
                                        ng-required="true"
                                        close-text="Close">

                                 <span class="input-group-addon">
                                   <button
                                           type="button"
                                           class="FilterDatePopup-button"
                                           ng-click="openPicker($event, filter.columnName, 'to')">
                                       <i class="fa fa-calendar"></i>
                                   </button>
                                 </span>
                                <input
                                        type="text"
                                        class="FilterDatePopup-input form-control"
                                        datepicker-popup="{{ format }}"
                                        ng-model="selectedFilters[filter.columnName].to.date"
                                        is-open="selectedFilters[filter.columnName].to.opened"
                                        min-date="minDate"
                                        max-date="'2015-06-22'"
                                        datepicker-options="dateOptions"
                                        date-disabled="disabled(date, mode)"
                                        ng-required="true"
                                        close-text="Close">
                            </div>
                        </div>


                    </div>
                    <div class="col-sm-3 form-inline">
                        <span class="checkbox"><label><input type="checkbox" ng-model="selectedFilters[filter.columnName].undef"> saknar värde</label></span>
                    </div>
                </div>
            </div>

            <div class="MultiFilter-row">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">Valbar</div>
                    <div class="MultiFilter-row-filterKnobs col-sm-6">
                        <select ng-options="filter.columnName as filter.question for filter in filters | filter: {isChosen: false}" ng-model="chosenFilter" name="" id="" class="form-control">
                            <option value="">Välj sökkriterium</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- <div class="MultiFilter-row">
                <div class="row">
                    <div class="MultiFilter-row-label col-sm-3">Debug</div>
                    <div class="MultiFilter-row-filterKnobs col-sm-9">{{ selectedFilters }}</div>
                </div>
            </div> -->
        </div>



        <div class="table-responsive">
            <table id="Table--patients" width="100%" class="data-table table responsive table-striped table-bordered row-border hover">
                <thead>
                        <tr>
                            <!--<th>Mer</th>-->
                            <th class="EmpId">Personnummer</th>
                            <th class="EmpId">Senaste besök</th>
                            <th ng-repeat="f in filters | filter:{isChosen:true}" once-text="f.question"></th>
                            <th>Funktioner</th>
                        </tr>
                    </thead>
                <tbody>
                    <tr ng-repeat="subject in ItemsByPage[currentPage] | orderBy:columnToOrder:reverse">
                        <!--<td ng-click="toggleDetail(subject)" class="details-control"><i class="fa fa-plus-circle fa-1x"></i></td>-->
                        <td once-text="subject.snr"></td>
                        <td once-text="subject.contactDate | date:'yyyy-MM-dd'"></td>
                        <td ng-repeat="f in filters | filter:{isChosen:true}" once-text='lookupName(f, subject[f.columnName])'></td>
                        <td><a target="_blank" once-href="'#/inloggad/patient/' + subject.subjectID" class="Button Button--info Button--small">Visa profil</a></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <ul class="pagination pagination-sm" ng-show="ItemsByPage.length > 1" style="cursor: pointer">
            <li ng-class="{active:0}"><a ng-click="firstPage()">Sida 1</a>

            </li>
            <li ng-repeat="n in range(ItemsByPage.length)"> <a ng-click="setPage()" ng-bind="n+1">1</a>

            </li>
            <li ng-show="ItemsByPage">
                <a ng-click="lastPage()">Sista sidan</a>
            </li>
        </ul>

        <!--  <pre>
                  {{ selectedFilters | json }}

          </pre>-->



        <!--      <div class="table-responsive">
                  <table id="Table--patients" datatable="ng" dt-options="dtOptions" dt-column-defs="dtColumnDefs" width="100%" class="table responsive table-striped table-bordered row-border hover">
                      <thead>
                      <tr>
                          <td>Mer</td>
                          <td>Personnummer</td>
                          <td>Senaste besök</td>
                          &lt;!&ndash; <td>Blodtryck</td> &ndash;&gt;
                          <td>HbA1c</td>
                          <td ng-repeat="f in filters | filter:{isChosen:true}">{{ f.question }}</td>

                          <td>Funktioner</td>

                          <td ng-repeat="f in filters | filter:{isChosen:true}">{{ f }}</td>

                      </tr>
                      </thead>
                      <tbody>
                      <tr ng-repeat="subject in model.filteredSubjects">
                          <td class="details-control"><i class="fa fa-plus-circle fa-1x"></i></td>
                          <td once-text="subject.aggregatedProfile.subject.socialNumber"></td>
                          <td once-text="subject.aggregatedProfile.contactDate | date:'yyyy-MM-dd'"></td>
                          &lt;!&ndash; <td once-text="subject.aggregatedProfile.bpDiastolic"</td> &ndash;&gt;
                          <td once-text="subject.aggregatedProfile.hba1c"></td>
                          &lt;!&ndash;<td ng-repeat="f in filters | filter:{isChosen:true}">{{ subject.aggregatedProfile[f.columnName] }}</td>&ndash;&gt;

                          <td><a once-href="'#/inloggad/patient/' + subject.subjectID" class="Button Button--info Button--small">Visa profil</a></td>
                      </tr>
                      </tbody>
                  </table>
              </div>

      -->

    </div>
</div>


